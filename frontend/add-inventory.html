<div class="page-add-inventory">
    <div class="page-header">
        <h1>Add Inventory Item</h1>
    </div>
    
    <form id="addInventoryForm" class="form-container">
        <div class="form-group">
            <label for="invName">Item Name *</label>
            <input type="text" id="invName" name="name" required placeholder="Enter item name">
        </div>
        <div class="form-group">
            <label for="invQuantity">Quantity *</label>
            <input type="number" id="invQuantity" name="quantity" required placeholder="Enter quantity">
        </div>
        <div class="form-group">
            <label for="invPurchaseDate">Purchase Date *</label>
            <input type="date" id="invPurchaseDate" name="purchaseDate" required>
        </div>
        <div class="form-group">
            <label for="invPurchasePrice">Purchase Price (PKR) *</label>
            <input type="number" id="invPurchasePrice" name="purchasePrice" step="0.01" required placeholder="Enter purchase price">
        </div>
        <div class="form-group">
            <label>
                <input type="checkbox" id="invNoExpiry" name="hasNoExpiry">
                No Expiry Date
            </label>
        </div>
        <div class="form-group" id="expiryDateGroup">
            <label for="invExpiryDate">Expiry Date</label>
            <input type="date" id="invExpiryDate" name="expiryDate">
        </div>
        <button type="submit" class="btn btn-primary">Add Inventory Item</button>
    </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Set default date to today
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('invPurchaseDate').value = today;
    
    // Handle expiry date checkbox
    document.getElementById('invNoExpiry').addEventListener('change', function() {
        document.getElementById('expiryDateGroup').style.display = this.checked ? 'none' : 'block';
    });
    
    document.getElementById('addInventoryForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const formData = new FormData(this);
        const hasNoExpiry = document.getElementById('invNoExpiry').checked;
        
        const inventoryData = {
            name: formData.get('name'),
            quantity: parseInt(formData.get('quantity')),
            purchaseDate: formData.get('purchaseDate'),
            purchasePrice: parseFloat(formData.get('purchasePrice')),
            expiryDate: hasNoExpiry ? null : formData.get('expiryDate'),
            hasNoExpiry: hasNoExpiry
        };
        
        try {
            const response = await fetch('/api/inventory', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(inventoryData)
            });
            
            if (response.ok) {
                this.reset();
                // Reset dates
                document.getElementById('invPurchaseDate').value = today;
                document.getElementById('invNoExpiry').checked = false;
                document.getElementById('expiryDateGroup').style.display = 'block';
                alert('Inventory item added successfully!');
            } else {
                throw new Error('Failed to add inventory item');
            }
        } catch (error) {
            console.error('Error:', error);
            alert('Failed to add inventory item');
        }
    });
});
</script>
